{% extends 'dashboard/admin_layout_base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'dashboard/admin.css' %}">
{% endblock %}

{% block panel_content %}

    <div class="filter-bar">
        <input type="date" name="start_date" id="start-date">
        <input type="date" name="end_date" id="end-date">
        <input type="text" placeholder="Search..." id="search-input">
        <button class="btn-generate" onclick="alert('Report generation feature coming soon!')">Generate Report</button>
    </div>

    <h2 class="section-title">Analytics Overview</h2>
    <div class="analytics-grid">
        <div class="stat-card">
            <div class="label">Total Users</div>
            <div class="value">{{ total_users }}</div>
        </div>
        <div class="stat-card">
            <div class="label">Total Vendors</div>
            <div class="value">{{ total_vendors }}</div>
        </div>
        <div class="stat-card">
            <div class="label">Total Products</div>
            <div class="value">{{ total_products }}</div>
        </div>
        <div class="stat-card">
            <div class="label">Pending Applications</div>
            <div class="value">{{ pending_applications }}</div>
        </div>
    </div>

    <h2 class="section-title">Activity Trends</h2>
    <div class="report-details-grid">
        <div class="chart-container">
            <strong>Products Listed (Last 7 Days)</strong>
            <canvas id="salesTrendChart"></canvas>
        </div>
        <div class="table-container">
            <table class="report-table">
                <thead><tr><th>ID</th><th>Activity</th><th>Details</th><th>Info</th></tr></thead>
                <tbody>
                    {% for item in report_data %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.type }}</td>
                        <td>{{ item.value }}</td>
                        <td>{{ item.status }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4">No recent activity</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="export-buttons">
                <button class="btn-export" onclick="window.print()">Print Dashboard</button>
                <button class="btn-export" onclick="alert('CSV export feature coming soon!')">Export CSV</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {{ chart_labels|json_script:"chart-labels" }}
    {{ chart_data|json_script:"chart-data" }}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const labels = JSON.parse(document.getElementById('chart-labels').textContent);
            const data = JSON.parse(document.getElementById('chart-data').textContent);
            
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            
            const salesTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Products Listed',
                        data: data,
                        borderColor: '#285429',
                        backgroundColor: 'rgba(40, 84, 41, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#285429',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Noto Sans',
                                    size: 12,
                                    weight: '600'
                                },
                                color: '#333333'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#285429',
                            titleFont: {
                                family: 'Noto Sans',
                                size: 13,
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Noto Sans',
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: true,
                                color: '#ebebeb',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: 'Noto Sans',
                                    size: 11
                                },
                                color: '#666',
                                precision: 0
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Noto Sans',
                                    size: 11
                                },
                                color: '#666'
                            }
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}