{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/search.css' %}">

<main class="container">
    <aside class="sidebar">
        <h2>Filters</h2>
        <button class="sidebar-btn home-btn active">
            <div class="circle">
                <img src="{% static 'icons/home.png' %}" alt="All Icon" class="icon">
            </div>
            <span>All Results</span>
        </button>

        <h2>Categories</h2>
        <button class="sidebar-btn fresh-btn">
            <div class="circle"><img src="{% static 'icons/fresh.png' %}" alt="Fresh Icon" class="icon"></div>
            <span>Fresh Produce</span>
        </button>
        <button class="sidebar-btn grains-btn">
            <div class="circle"><img src="{% static 'icons/grains.png' %}" alt="Grains Icon" class="icon"></div>
            <span>Grains and Staples</span>
        </button>
        <button class="sidebar-btn meat-btn">
            <div class="circle"><img src="{% static 'icons/meat.png' %}" alt="Meat Icon" class="icon"></div>
            <span>Meat, Poultry and Seafood</span>
        </button>
        <button class="sidebar-btn dairy-btn">
            <div class="circle"><img src="{% static 'icons/dairy.png' %}" alt="Dairy Icon" class="icon"></div>
            <span>Dairy & Eggs</span>
        </button>
        <button class="sidebar-btn packaged-btn">
            <div class="circle"><img src="{% static 'icons/packaged.png' %}" alt="Packaged Icon" class="icon"></div>
            <span>Packaged Goods</span>
        </button>
        <button class="sidebar-btn local-btn">
            <div class="circle"><img src="{% static 'icons/local.png' %}" alt="Local Icon" class="icon"></div>
            <span>Local & Specialty Products</span>
        </button>
        <button class="sidebar-btn service-btn">
            <div class="circle"><img src="{% static 'icons/service.png' %}" alt="Service Icon" class="icon"></div>
            <span>Services</span>
        </button>
    </aside>

    <div class="main">
        <section class="content">
            
            <div style="margin-bottom: 20px;">
                {% if query %}
                    {% if results %}
                        <h2 style="color: var(--accent-primary); margin: 0;">Search results for "{{ query }}"</h2>
                    {% else %}
                        <h2 style="color: var(--text-primary); margin: 0;">No results for "{{ query }}"</h2>
                    {% endif %}
                {% else %}
                    <h2 style="margin: 0;">Search Products</h2>
                {% endif %}
            </div>

            <div class="grid" id="search-grid-container">
                {% if results %}
                    {% for product in results %}
                        <div class="grid-item" data-product-id="{{ product.id }}" style="cursor: pointer;">
                            
                            {% if product.image %}
                                <div class="product-image" style="background-image: url('{{ product.image.url }}'); background-size: cover;"></div>
                            {% else %}
                                <div class="product-image"></div>
                            {% endif %}

                            <div class="product-info">
                                <h3 class="product-name">{{ product.name }}</h3>
                                <p class="product-price">â‚±{{ product.price }}</p>

                                {% if product.vendor.vendorprofile %}
                                    <p class="product-vendor">
                                        Seller: 
                                        <span class="vendor-name-container">
                                            {{ product.vendor.vendorprofile.shop_name }}
                                            {% if product.vendor.vendorprofile.is_verified %}
                                                <img src="{% static 'icons/verified.png' %}" class="vendor-badge" alt="Verified" title="Verified Vendor">
                                            {% endif %}
                                        </span>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div style="grid-column: 1 / -1; text-align:center; padding: 60px; color: #666; background: #fff; border-radius: 8px;">
                        {% if query %}
                            <img src="{% static 'icons/search.png' %}" style="width: 50px; opacity: 0.3; margin-bottom: 15px; filter: grayscale(1);">
                            <p style="font-size: 1.1rem; margin-bottom: 5px;">We couldn't find any matches for "<strong>{{ query }}</strong>".</p>
                            <p style="font-size: 0.9rem;">Try checking your spelling or using different keywords.</p>
                        {% else %}
                            <p>Enter a keyword in the header search bar to find products.</p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>

        </section>
    </div>
</main>

<script>
    // Simple click listener for search results (can expand to modals later)
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.grid-item').forEach(card => {
            card.addEventListener('click', () => {
                // If you want to use the Home page modals here, you need to include the modal HTML 
                // and the full JS logic from home.html. 
                // For now, this just confirms the click works.
                console.log("Clicked product:", card.dataset.productId);
            });
        });
    });
</script>

{% endblock %}