{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/consumer_profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications_dropdown.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Song+Myung&display=swap" rel="stylesheet">
    <style>
        .form-grid .form-group.full-width {
            grid-column: 1 / -1; 
        }
        /* Ensure strict alignment with consumer navbar */
        .navbar .nav-icons {
            display: flex;
            align-items: center;
            gap: 25px; /* Matched spacing from images */
        }
        
        /* Icon Sizing Consistency */
        .cart-icon-svg, .notif-icon-svg, .nav-icon {
            width: 26px;
            height: 26px;
            fill: var(--text-primary);
            transition: transform 0.2s;
        }
        
        .nav-icons a:hover svg, 
        .notif-nav-container:hover svg {
            fill: var(--accent-primary);
            transform: scale(1.05);
        }

        /* Hide search bar as per request */
        .search-bar { visibility: hidden !important; opacity: 0; }
        
        /* Layout fixes */
        body { overflow: hidden; }
        .sidebar { flex-shrink: 0 !important; width: 350px !important; }
        .main { flex-grow: 1 !important; min-width: 0 !important; width: auto !important; }
    </style>
{% endblock %}

{% block content %}
<header class="navbar">
    <a href="{% url 'home' %}" style="text-decoration: none;">
        <div class="logo">
            <img src="{% static 'icons/sari-sari-logo.png' %}" alt="Logo Icon" class="logo-icon">
            <span style="font-weight: 800;">
                <span class="brand-green">Sari-</span><span class="brand-orange">Sari</span>
            </span>
        </div>
    </a>

    <div class="search-bar">
        <div class="search-container-wrapper">
            <input type="text" id="base-search-input" name="q" placeholder="Search products...">
        </div>
    </div>

    <div class="nav-icons">
        <a href="{% url 'product_list' %}" style="display: flex; align-items: center; text-decoration: none;" title="Manage My Shop">
            <svg class="cart-icon-svg" viewBox="0 0 24 24">
                <path d="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z"/>
            </svg>
        </a>
        
        <div class="notif-nav-container" id="notif-container">
            <a href="{% url 'notification_list' %}" style="display:flex; align-items:center; text-decoration:none;">
                <svg class="notif-icon-svg" viewBox="0 0 24 24">
                    <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
                </svg>
                <span class="notif-badge" id="nav-notif-badge" style="display:none;">0</span>
            </a>

            <div class="notif-dropdown">
                <h4>Recent Notifications</h4>
                <div class="notif-dropdown-list" id="nav-notif-list">
                    <div class="empty-notif">Loading...</div>
                </div>
                <div class="notif-dropdown-footer">
                    <a href="{% url 'notification_list' %}" class="view-all-link">View All Notifications</a>
                </div>
            </div>
        </div>

        <a href="{% url 'profile' %}" style="display: flex; align-items: center;">
            {% if user.avatar %}
                <img src="{{ user.avatar.url }}" alt="Profile" class="nav-icon" style="border-radius: 50%; object-fit: cover; width: 28px; height: 28px; border: 1px solid #ddd;">
            {% else %}
                <img src="{% static 'icons/profile.png' %}" alt="Profile Icon" class="nav-icon">
            {% endif %}
        </a>
    </div>
</header>

<div class="profile-container">
    <aside class="sidebar">
        <nav>
            <ul>
                <li><a href="{% url 'profile' %}">My Account</a></li>
                <li><a href="{% url 'notification_list' %}">Notifications</a></li>
                <li><a href="{% url 'logout' %}">Logout</a></li>
                
                {% if user.role == 'VENDOR' %}
                    <li class="active"><a href="{% url 'vendor_profile' %}" class="vendor-link" style="color: var(--accent-primary); font-weight: bold;">Manage Vendor Profile</a></li>
                {% endif %}
            </ul>
        </nav>
    </aside>
    
    <div class="main-content">
        <div class="form-box">
            <h1>Edit Your Vendor Profile</h1>
            <p>View and manage your vendor profile.</p>
            <form method="post" enctype="multipart/form-data" class="profile-form">
                {% csrf_token %}
                <div class="profile-picture-section">
                    {% if form.instance.profile_image %}
                        <img src="{{ form.instance.profile_image.url }}" alt="Profile Avatar" class="profile-avatar">
                    {% else %}
                        <img src="{% static 'icons/placeholder.png' %}" alt="Profile Avatar" class="profile-avatar">
                    {% endif %}
                    <div>
                        {{ form.profile_image.label_tag }}
                        {{ form.profile_image }}
                        {{ form.profile_image.errors }}
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        {{ form.shop_name.label_tag }}
                        {{ form.shop_name }}
                        {{ form.shop_name.errors }}
                    </div>
                    <div class="form-group">
                        {{ form.contact_number.label_tag }}
                        {{ form.contact_number }}
                        {{ form.contact_number.errors }}
                    </div>
                    <div class="form-group">
                        {{ form.business_permit_number.label_tag }}
                        {{ form.business_permit_number }}
                        {{ form.business_permit_number.errors }}
                    </div>
                    
                    <div class="form-group full-width">
                        {{ form.pickup_address.label_tag }}
                        {{ form.pickup_address }}
                        {{ form.pickup_address.errors }}
                    </div>
                    <div class="form-group">
                        {{ form.barangay.label_tag }}
                        {{ form.barangay }}
                        {{ form.barangay.errors }}
                    </div>
                    <div class="form-group">
                        {{ form.city.label_tag }}
                        {{ form.city }}
                        {{ form.city.errors }}
                    </div>
                    
                    <div class="form-group full-width">
                        {{ form.shop_description.label_tag }}
                        {{ form.shop_description }}
                        {{ form.shop_description.errors }}
                    </div>
                    <div class="form-group full-width">
                        {{ form.farming_practices.label_tag }}
                        {{ form.farming_practices }}
                        {{ form.farming_practices.errors }}
                    </div>
                    <div class="form-group">
                        {{ form.experience_years.label_tag }}
                        {{ form.experience_years }}
                        {{ form.experience_years.errors }}
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Manually trigger notification logic
    document.addEventListener('DOMContentLoaded', function() {
        if(window.fetchNotifications) {
            window.fetchNotifications();
        }
        const notifContainer = document.getElementById('notif-container');
        if(notifContainer) {
            notifContainer.addEventListener('mouseenter', window.fetchNotifications);
        }
    });
</script>
{% endblock %}